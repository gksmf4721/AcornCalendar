<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"  layout:decorate="~{fragments/layout/main_layout}">
    <th:block layout:fragment="mainContent">
        <div class="w_main_content">
            <div class="w_main_item">
				<div id="smallCalendar"></div>
            </div>

			<div class="w_main_item">
				<div class="w_myCal">
                    <h3>내 캘린더</h3>
                    <div class="right"><button class="w_plus" onclick="w_modal_open();" >+</h1></div>
                </div>
				<div class="w_myCalList" id="w_myCalList_main">
					<!-- <div class="w_myCalListDetail">
						<label for="myCalCheck1">
							<input type="checkbox" id="myCalCheck1" class="login_id_sv">
							<span for="myCalCheck1"></span>
							개인 캘린더
						</label>
					</div>
					<div class="w_myCalListDetail">
						<label for="myCalCheck2">
							<input type="checkbox" id="myCalCheck2" class="login_id_sv">
							<span for="myCalCheck2"></span>
							커플 캘린더
						</label>
					</div> -->
				</div>

				<div class="w_modal" id="calList_modal" data-openyn="N">
					<div class="w_modal_item"><span>캘린더 이름</span><input type="text" id="P_calName" placeholder="캘린더이름" ></div>
					<div class="w_modal_item"><span>캘린더 종류</span>
						<select id="P_calType">
						<option value="" selected>선택하세요</option>
						<option value="S">개인</option>
						<option value="C">커플</option>
						<option value="F">친구</option>
					</select></div>
					<div class="w_modal_item"><span>특정 멤버</span>
						<!--임시용 :: 나중에 검색으로 변경할 것-->
						<input type="text" id="P_mSeqParty" placeholder="특정 멤버 번호">
					</div>
					
					<div class="w_modal_item"><span>내 회원번호<br>임시용</span><input type="text" id="P_mSeqMake" th:value="${data.session_m_seq}" readonly></div>
					<div class="modalBtn"><input type="button" onclick="saveCalType();" value="저장"></div>
					<div class="modalBtn"><input type="button" onclick="aa();" value="저장"></div>
				</div>
            </div>
			<div class="main_item">
				<div class="w_title cal">
                    <div class="w_left"><a href="#" class="cal">캘린더</a></div>
                    <div class="w_right">
						<div class="box"><img th:src="@{../img/attach/min.png}"><img th:src="@{../img/attach/max.png}"><img th:src="@{../img/attach/close.png}"></div>
					</div>
                </div>
				<div class="cendar_container">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
		<aside>
			<!-- 모달창 팝업 -->
			<div id="modalContainer">
				<div id="modalContent" class="modalContent">
					<div class="m_title">
						<h1>상세보기</h1>
					</div>
					<div class="m_wrap">
						<span>제목</span>
						<input type="text" id="cal_title" placeholder="타이틀">
					</div>
					<div class="m_wrap">
						<span>일시</span>
						<label for="cal_allDay">
							<input type="checkbox" id="cal_allDay" class="login_id_sv" onclick="allDayCheck();">
							<span for="cal_allDay"></span>
							종일
						</label>
						<div class="m_date">
							<span>시작</span>
							<input type="date" id="cal_startDate" placeholder="타이틀">
							<input type="time" id="cal_startTime" >
						</div>
						<div class="m_date">
							<span>종료</span>
							<input type="date" id="cal_endDate" placeholder="타이틀">
							<input type="time" id="cal_endTime" >
						</div>
					</div>
					<div class="m_wrap">
						<span>카테고리</span>
						<select>
							<option>휴가</option>
							<option>A</option>
							<option>B</option>
							<option>C</option>
							<option>D</option>
						</select>
					</div>
					<div class="m_wrap cont">
						<span>내용</span>
						<div contenteditable="true" class="divTextarea"></div>
					</div>
				</div>
				<div class="modalBtn">
					<input type="button" value="저장" id="cAddBtn" onclick="save();">
					<button id="modalCloseButton" onclick="modalSlide('', '', 'N');">닫기</button>
				</div>
			</div>
		</aside>
		
<script>
const checkAllDay = document.getElementById("cal_allDay");
const editStartTime = document.getElementById("cal_startTime");
const editEndTime = document.getElementById("cal_endTime");
const P_mSeq = document.getElementById("P_mSeqMake").value;

document.addEventListener('DOMContentLoaded', function(){
	getList();
});

function getList(){
	var w_myCalList = document.getElementById("w_myCalList_main");
	$.ajax({
         type : "GET",
         contentType : "application/json",
         url : '/calendar.json/' + P_mSeq,
         dataType : 'json',
         success : function(rslt){
			let dataResult = "";
             if(rslt.resultCode == 200){
				var resultObj = rslt.data.items;
				console.log(resultObj);
				 for(let i=0; i<resultObj.length; i++){
					dataResult += `<div class="w_myCalListDetail">
						<label for="myCalCheck${i}">
							<input type="checkbox" id="myCalCheck${i}" class="login_id_sv">
							<span for="myCalCheck${i}"></span>
								${resultObj[i].calName}
						</label>
					</div>`;
				 }
				w_myCalList.innerHTML = dataResult;
             }else{
                 $.alertError(rslt.resultMsg);
             }
         },
         error : function(request, status, error){
             $.alertError("javaScript error : "+ error + "request :" + request + "status : " + status);
         }
     });
}

function allDayCheck() {
	if (checkAllDay.checked) {
		//종일 체크 시, 시간 선택 불가능
		editStartTime.disabled = true;
		editEndTime.disabled = true;
		valueReset();
	} else {
		//종일 체크 해제시, 시간 선택 가능
		editStartTime.disabled = false;
		editEndTime.disabled = false;
	}
}

function aa(){
	let calType = document.getElementById("P_calType");
	let P_calType = (calType.options[calType.selectedIndex]);
	// Set the selected index to the index of the default option
	calType.selectedIndex = 0; // Index of the default option

	
}
function saveCalType(){
	let calType = document.getElementById("P_calType");
	let P_calType = (calType.options[calType.selectedIndex].value);
	let P_calName = document.getElementById("P_calName");
	let P_mSeqMake = document.getElementById("P_mSeqMake");
	let P_mSeqParty = document.getElementById("P_mSeqParty");
	
	if(P_calName == ""){
		$.alertError("캘린더제목을 작성해주세요");
		return false;
	}else if(P_mSeqParty == ""){
		$.alertError("참가할 회원을 작성해주세요");
		return false;
	}
	
	ajaxData = {calType: P_calType
					 , mSeqMake : P_mSeqMake.value
					 , mSeqParty : P_mSeqParty.value
					 , calName : P_calName.value }
	$.ajax({
         type : "POST",
         contentType : "application/json",
         url : '/calendar.json',
         data : JSON.stringify(ajaxData),
         dataType : 'json',
         success : function(rslt){
             if(rslt.resultCode == 200){
                 $.alertSuccess("성공:: " + rslt.resultCode + "  메세지 ::" + rslt.resultMsg);
				 P_calName.value = "";
				 P_mSeqParty.value = "";
				 calType.selectedIndex = 0; // Index of the default option
				// Trigger the change event
				var event = new Event('change');
				calType.dispatchEvent(event);
				 getList();
				 w_modal_open();
             }else{
                 $.alertError(rslt.resultMsg);
             }
         },
         error : function(request, status, error){
             $.alertError("javaScript error : "+ error + "request :" + request + "status : " + status);
         }
     });
	
}

function w_modal_open(){
	var calListModal = document.getElementById("calList_modal");
	calListModal.dataset.openyn = calListModal.dataset.openyn == "N" ? "Y" : "N";
}

</script>
<script type="text/javascript" th:src="@{/js/calendar.js}"></script>
<script type="text/javascript" th:src="@{/js/calendarRegi.js}"></script>
</th:block>
</html>