<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"  layout:decorate="~{fragments/layout/main_layout}">
    <th:block layout:fragment="mainContent">
        <div class="main_content">
            <div class="main_item">
				<div class="w_title cal">
                    <div class="w_left"><a href="/mypage.do" class="cal">내정보</a></div>
                    <div class="w_right">
                        <div class="box"><img th:src="@{../img/attach/min.png}"><img th:src="@{../img/attach/max.png}"><img th:src="@{../img/attach/close.png}"></div>
                    </div>
                </div>
            </div>

			<div class="main_item">
				<div class="w_title cal">
                    <div class="w_left"><a href="#" class="cal">그룹웨어</a></div>
                    <div class="w_right">
                        <div class="box"><img th:src="@{../img/attach/min.png}"><img th:src="@{../img/attach/max.png}"><img th:src="@{../img/attach/close.png}"></div>
                    </div>
                </div>
				<div class="w_info">
					<div><button onclick="saveCalType();">+</button></div>
					<select id="P_calType">
						<option value="S">개인</option>
						<option value="C">커플</option>
						<option value="F">친구</option>
					</select>
					<input type="text" id="P_calName" placeholder="캘린더이름" >
					<input type="text" id="P_mSeqMake" value="4" readonly> 
					<input type="text" id="P_mSeqParty" placeholder="참가할회원번호" >
				</div>
            </div>
			<div class="main_item">
				<div class="w_title cal">
                    <div class="w_left"><a href="#" class="cal">캘린더</a></div>
                    <div class="w_right">
						<div class="box"><img th:src="@{../img/attach/min.png}"><img th:src="@{../img/attach/max.png}"><img th:src="@{../img/attach/close.png}"></div>
					</div>
                </div>
				<div class="cendar_container">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
		<aside>
			<!-- 모달창 팝업 -->
			<div id="modalContainer">
				<div id="modalContent" class="modalContent">
					<div class="m_title">
						<h1>상세보기</h1>
					</div>
					<div class="m_wrap">
						<span>제목</span>
						<input type="text" id="cal_title" placeholder="타이틀">
					</div>
					<div class="m_wrap">
						<span>일시</span>
						<label for="cal_allDay">
							<input type="checkbox" id="cal_allDay" class="login_id_sv" onclick="allDayCheck();">
							<span for="cal_allDay"></span>
							종일
						</label>
						<div class="m_date">
							<span>시작</span>
							<input type="date" id="cal_startDate" placeholder="타이틀">
							<input type="time" id="cal_startTime" >
						</div>
						<div class="m_date">
							<span>종료</span>
							<input type="date" id="cal_endDate" placeholder="타이틀">
							<input type="time" id="cal_endTime" >
						</div>
					</div>
					<div class="m_wrap">
						<span>카테고리</span>
						<select>
							<option>휴가</option>
							<option>A</option>
							<option>B</option>
							<option>C</option>
							<option>D</option>
						</select>
					</div>
					<div class="m_wrap cont">
						<span>내용</span>
						<div contenteditable="true" class="divTextarea"></div>
					</div>
				</div>
				<div class="modalBtn">
					<input type="button" value="저장" id="cAddBtn" onclick="save();">
					<button id="modalCloseButton" onclick="modalSlide('', '', 'N');">닫기</button>
				</div>
			</div>
		</aside>
		
<script>
const checkAllDay = document.getElementById("cal_allDay");
const editStartTime = document.getElementById("cal_startTime");
const editEndTime = document.getElementById("cal_endTime");

function allDayCheck() {
	if (checkAllDay.checked) {
		//종일 체크 시, 시간 선택 불가능
		editStartTime.disabled = true;
		editEndTime.disabled = true;
		valueReset();
	} else {
		//종일 체크 해제시, 시간 선택 가능
		editStartTime.disabled = false;
		editEndTime.disabled = false;
	}
}

function saveCalType(){
	const calType = document.getElementById("P_calType");
	const P_calType = (calType.options[calType.selectedIndex].value);
	const P_calName = document.getElementById("P_calName").value;
	const P_mSeqMake = document.getElementById("P_mSeqMake").value;
	const P_mSeqParty = document.getElementById("P_mSeqParty").value;
	
	if(P_calName == ""){
		$.alertError("캘린더제목을 작성해주세요");
		return false;
	}else if(P_mSeqParty == ""){
		$.alertError("참가할 회원을 작성해주세요");
		return false;
	}
	
	ajaxData = {calType: P_calType
					 , mSeqMake : P_mSeqMake
					 , mSeqParty : P_mSeqParty
					 , calName : P_calName }
	console.log(ajaxData);
	$.ajax({
         type : "POST",
         contentType : "application/json",
         url : '/calendar.json',
         data : JSON.stringify(ajaxData),
         dataType : 'json',
         success : function(rslt){
             if(rslt.resultCd == 1){
                 $.alertSuccess("성공:: " + rslt.resultCd + "  메세지 ::" + rslt.resultMsg);
             }else{
                 $.alertError(rslt.resultMsg);
             }
         },
         error : function(request, status, error){
             $.alertError("javaScript error : "+ error + "request :" + request + "status : " + status);
         }
     });
	
}

</script>
<script type="text/javascript" th:src="@{/js/calendar.js}"></script>
<script type="text/javascript" th:src="@{/js/calendarRegi.js}"></script>
</th:block>
</html>